import{M as e,w as t}from"./message-wrapper-Card6HA-.js";import"./data.js";const s={onChange(e){return e?(settings.settingsStorage.addListener("change",e),this):this},offChange(){return settings.settingsStorage.removeListener("change"),this},getItem:e=>settings.settingsStorage.getItem(e),setItem:(e,t)=>settings.settingsStorage.setItem(e,t),clear:()=>settings.settingsStorage.clear(),removeItem(e){settings.settingsStorage.removeItem(e)},getAll:()=>settings.settingsStorage.toObject()},n=t(new e({logger:Logger.getLogger("side-message")}),Logger.getLogger("message-builder-device")),i={convert(e){throw new Error("Image Convert is only avalaible in API_LEVEL 3.0+")}},o=[{onInit(){this.logger=Logger.getLogger(sideService.appInfo.app.appName),this.logger.scope=sideService.appInfo.app.appName,this.logger.name="side-service",this.log=(...e)=>{this.logger.log(...e)},this.error=(...e)=>{e[0]instanceof Error?this.logger.error(...e):this.logger.error({},...e)},this.debug=(...e)=>{this.logger.debug(...e)}}},{onInit(){this.settings=s,this._onSettingsChange=this.onSettingsChange?.bind(this),s.onChange(this._onSettingsChange),"undefined"!=typeof sideService&&sideService.launchReasons.settingsChanged&&this._onSettingsChange(sideService.launchArgs)},onDestroy(){this._onSettingsChange&&s.offChange(this._onSettingsChange)}},{onInit(){this.messaging=n,this._onCall=this.onCall?.bind(this),this._onRequest=this.onRequest?.bind(this),this.messaging.onCall(this._onCall).onRequest(this.__onRequest.bind(this)),this.messaging.start()},onDestroy(){this._onCall&&this.messaging.offOnCall(this._onCall),this._onRequest&&this.messaging.offOnRequest(this._onRequest),this.messaging.stop()},request(e,t={}){return this.messaging.request(e,t)},call(e){return this.messaging.call(e)},__onRequest(e,t){return"http.request"===e.method?this.httpRequestHandler(e,t):this._onRequest(e,t)},fetch:e=>fetch(function(e){const t={timeout:1e4,...e};return t.baseURL&&(t.url=new URL(t.url,t.baseURL).toString()),t}(e)),httpRequestHandler(e,t){return this.fetch(e.params).then((e=>{t(null,{status:e.status,statusText:e.statusText,headers:e.headers,body:e.body})})).catch((e=>t({code:1,message:e.message})))}},{sendFile(e,t){throw new Error("File Transfer only supported in APLI_LEVEL 3.0+")}}],r=[function(e){e.download=function(e,t){throw new Error("Download is only avalaible in API_LEVEL 3.0+")}},function(e){e.convert=function(e){return i.convert(e)}}];function g(e){const t={};return r.forEach((e=>e(t))),o.forEach((e=>Object.assign(t,e))),{...e,...t,onInit(t){o.forEach((e=>e.onInit?.apply(this,t))),e.onInit?.apply(this,t)},onRun(t){o.forEach((e=>e.onRun?.apply(this,t))),e.onRun?.apply(this,t)},onDestroy(t){e.onDestroy?.apply(this,t),o.reverse().forEach((e=>e.onDestroy?.apply(this,t)))}}}export{g as BaseSideService,i as convertLib,s as settingsLib};
